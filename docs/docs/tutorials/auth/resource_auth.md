_í•œêµ­ì–´ë¡œ ê¸°ê³„ë²ˆì—­ë¨_

# ëŒ€í™” ë‚´ìš©ì„ ë¹„ê³µê°œë¡œ ë§Œë“¤ê¸° (2ë¶€/3ë¶€)

!!! ì£¼ì˜ "ì¸ì¦ ì‹œë¦¬ì¦ˆì˜ 2ë¶€ì…ë‹ˆë‹¤:" 

    1. [ê¸°ë³¸ ì¸ì¦](getting_started.md) - ë´‡ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ì‚¬ëŒ ì œì–´
    2. ë¦¬ì†ŒìŠ¤ ê¶Œí•œ ë¶€ì—¬ (ì—¬ê¸°ì— ìˆìŠµë‹ˆë‹¤) - ì‚¬ìš©ìì—ê²Œ ê°œì¸ ëŒ€í™” ì œê³µ
    3. [ìƒì‚° ì¸ì¦](add_auth_server.md) - ì‹¤ì œ ì‚¬ìš©ì ê³„ì • ì¶”ê°€ ë° OAuth2ë¥¼ ì‚¬ìš©í•œ ê²€ì¦

ì´ë²ˆ íŠœí† ë¦¬ì–¼ì—ì„œëŠ” ê° ì‚¬ìš©ìì—ê²Œ ê°œì¸ ëŒ€í™”ë¥¼ ì œê³µí•˜ê¸° ìœ„í•´ ì±—ë´‡ì„ í™•ì¥í•©ë‹ˆë‹¤. ìš°ë¦¬ëŠ” ì‚¬ìš©ìê°€ ìì‹ ì˜ ìŠ¤ë ˆë“œë§Œ ë³¼ ìˆ˜ ìˆë„ë¡ [ë¦¬ì†ŒìŠ¤ ìˆ˜ì¤€ ì ‘ê·¼ ì œì–´](../../concepts/auth.md#resource-level-access-control)ë¥¼ ì¶”ê°€í•  ê²ƒì…ë‹ˆë‹¤.

![ê¶Œí•œ ë¶€ì—¬ í•¸ë“¤ëŸ¬](./img/authorization.png)

???+ íŒ "í”Œë ˆì´ìŠ¤í™€ë” í† í°"
    
    [1ë¶€](getting_started.md)ì—ì„œ í–ˆë˜ ê²ƒì²˜ëŸ¼, ì´ ì„¹ì…˜ì—ì„œëŠ” ì„¤ëª… ëª©ì ìœ¼ë¡œ í•˜ë“œì½”ë”©ëœ í† í°ì„ ì‚¬ìš©í•  ê²ƒì…ë‹ˆë‹¤.
    ê¸°ë³¸ì„ ë§ˆìŠ¤í„°í•œ í›„ 3ë¶€ì—ì„œ "ìƒì‚° ì¤€ë¹„ ì™„ë£Œ" ì¸ì¦ ë°©ì‹ì— ëŒ€í•´ ë‹¤ë£° ê²ƒì…ë‹ˆë‹¤.

## ë¦¬ì†ŒìŠ¤ ê¶Œí•œ ë¶€ì—¬ ì´í•´í•˜ê¸°

ì§€ë‚œ íŠœí† ë¦¬ì–¼ì—ì„œëŠ” ëˆ„ê°€ ë´‡ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ”ì§€ë¥¼ ì œì–´í–ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ í˜„ì¬, ì¸ì¦ëœ ëª¨ë“  ì‚¬ìš©ìê°€ ë‹¤ë¥¸ ì‚¬ëŒì˜ ëŒ€í™”ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤! ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ [ë¦¬ì†ŒìŠ¤ ê¶Œí•œ ë¶€ì—¬](../../concepts/auth.md#resource-authorization)ë¥¼ ì¶”ê°€í•˜ê² ìŠµë‹ˆë‹¤.

ë¨¼ì €, [ê¸°ë³¸ ì¸ì¦](getting_started.md) íŠœí† ë¦¬ì–¼ì„ ì™„ë£Œí–ˆìœ¼ë©°, ë³´ì•ˆ ë´‡ì´ ì˜¤ë¥˜ ì—†ì´ ì‹¤í–‰ë  ìˆ˜ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”:

```bash
cd custom-auth
pip install -e .
langgraph dev --no-browser
```

> - ğŸš€ API: http://127.0.0.1:2024
> - ğŸ¨ ìŠ¤íŠœë””ì˜¤ UI: https://smith.langchain.com/studio/?baseUrl=http://127.0.0.1:2024
> - ğŸ“š API ë¬¸ì„œ: http://127.0.0.1:2024/docs

## ë¦¬ì†ŒìŠ¤ ê¶Œí•œ ë¶€ì—¬ ì¶”ê°€í•˜ê¸°

ì§€ë‚œ íŠœí† ë¦¬ì–¼ì„ ê¸°ì–µí•´ë³´ì„¸ìš”. [`Auth`](../../cloud/reference/sdk/python_sdk_ref.md#langgraph_sdk.auth.Auth) ê°ì²´ë¥¼ ì‚¬ìš©í•˜ì—¬ [ì¸ì¦ í•¨ìˆ˜](../../concepts/auth.md#authentication)ë¥¼ ë“±ë¡í–ˆìŠµë‹ˆë‹¤. LangGraph í”Œë«í¼ì€ ì´ë¥¼ ì‚¬ìš©í•˜ì—¬ ìˆ˜ì‹  ìš”ì²­ì˜ ë² ì–´ëŸ¬ í† í°ì„ ê²€ì¦í•©ë‹ˆë‹¤. ì´ì œ ìš°ë¦¬ëŠ” **ê¶Œí•œ ë¶€ì—¬** í•¸ë“¤ëŸ¬ë¥¼ ë“±ë¡í•˜ëŠ” ë° ì‚¬ìš©í•  ê²ƒì…ë‹ˆë‹¤.

ê¶Œí•œ ë¶€ì—¬ í•¸ë“¤ëŸ¬ëŠ” ì¸ì¦ì´ ì„±ê³µí•œ **í›„**ì— ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤. ì´ëŸ¬í•œ í•¸ë“¤ëŸ¬ëŠ” ë¦¬ì†ŒìŠ¤ì— [ë©”íƒ€ë°ì´í„°](../../concepts/auth.md#resource-metadata)ë¥¼ ì¶”ê°€í•˜ê³  ì‚¬ìš©ìê°€ ë³¼ ìˆ˜ ìˆëŠ” í•­ëª©ì„ í•„í„°ë§í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ì œ `src/security/auth.py`ë¥¼ ì—…ë°ì´íŠ¸í•˜ê³  ë§¤ ìš”ì²­ë§ˆë‹¤ ì‹¤í–‰ë˜ëŠ” í•˜ë‚˜ì˜ ê¶Œí•œ ë¶€ì—¬ í•¸ë“¤ëŸ¬ë¥¼ ì¶”ê°€í•˜ê² ìŠµë‹ˆë‹¤:

```python hl_lines="29-39" title="src/security/auth.py"
from langgraph_sdk import Auth

# ì´ì „ íŠœí† ë¦¬ì–¼ì—ì„œ ì‚¬ìš©í•œ í…ŒìŠ¤íŠ¸ ì‚¬ìš©ìë“¤
VALID_TOKENS = {
    "user1-token": {"id": "user1", "name": "Alice"},
    "user2-token": {"id": "user2", "name": "Bob"},
}

auth = Auth()


@auth.authenticate
async def get_current_user(authorization: str | None) -> Auth.types.MinimalUserDict:
    """ì´ì „ íŠœí† ë¦¬ì–¼ì˜ ì¸ì¦ í•¸ë“¤ëŸ¬ì…ë‹ˆë‹¤."""
    assert authorization
    scheme, token = authorization.split()
    assert scheme.lower() == "bearer"

    if token not in VALID_TOKENS:
        raise Auth.exceptions.HTTPException(status_code=401, detail="ì˜ëª»ëœ í† í°ì…ë‹ˆë‹¤.")

    user_data = VALID_TOKENS[token]
    return {
        "identity": user_data["id"],
    }


@auth.on
async def add_owner(
    ctx: Auth.types.AuthContext,  # í˜„ì¬ ì‚¬ìš©ìì— ëŒ€í•œ ì •ë³´ë¥¼ í¬í•¨í•©ë‹ˆë‹¤.
    value: dict,  # ìƒì„±ë˜ê±°ë‚˜ ì ‘ê·¼ë˜ëŠ” ë¦¬ì†ŒìŠ¤
):
    """ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±ìì—ê²Œë§Œ ë¹„ê³µê°œë¡œ ë§Œë“­ë‹ˆë‹¤."""
    # ì˜ˆì‹œ:
    # ctx: AuthContext(
    #     permissions=[],
    #     user=ProxyUser(
    #         identity='user1',
    #         is_authenticated=True,
    #         display_name='user1'
    #     ),
    #     resource='threads',
    #     action='create_run'
    # )
    # value: 
    # {
    #     'thread_id': UUID('1e1b2733-303f-4dcd-9620-02d370287d72'),
    #     'assistant_id': UUID('fe096781-5601-53d2-b2f6-0d3403f7e9ca'),
    #     'run_id': UUID('1efbe268-1627-66d4-aa8d-b956b0f02a41'),
    #     'status': 'pending',
    #     'metadata': {},
    #     'prevent_insert_if_inflight': True,
    #     'multitask_strategy': 'reject',
    #     'if_not_exists': 'reject',
    #     'after_seconds': 0,
    #     'kwargs': {
    #         'input': {'messages': [{'role': 'user', 'content': 'ì•ˆë…•í•˜ì„¸ìš”!'}]},
    #         'command': None,
    #         'config': {
    #             'configurable': {
    #                 'langgraph_auth_user': ... ì‚¬ìš©ì ê°ì²´...
    #                 'langgraph_auth_user_id': 'user1'
    #             }
    #         },
    #         'stream_mode': ['values'],
    #         'interrupt_before': None,
    #         'interrupt_after': None,
    #         'webhook': None,
    #         'feedback_keys': None,
    #         'temporary': False,
    #         'subgraphs': False
    #     }
    # }

    # ë‘ ê°€ì§€ ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤:
    # 1. ì‚¬ìš©ìì˜ IDë¥¼ ë¦¬ì†ŒìŠ¤ì˜ ë©”íƒ€ë°ì´í„°ì— ì¶”ê°€í•©ë‹ˆë‹¤. ê° LangGraph ë¦¬ì†ŒìŠ¤ì—ëŠ” ë¦¬ì†ŒìŠ¤ì™€ í•¨ê»˜ ì§€ì†ë˜ëŠ” `metadata` dictê°€ ìˆìŠµë‹ˆë‹¤.
    # ì´ ë©”íƒ€ë°ì´í„°ëŠ” ì½ê¸° ë° ì—…ë°ì´íŠ¸ ì‘ì—…ì—ì„œ í•„í„°ë§í•˜ëŠ” ë° ìœ ìš©í•©ë‹ˆë‹¤.
    # 2. ì‚¬ìš©ìê°€ ìì‹ ì˜ ë¦¬ì†ŒìŠ¤ë§Œ ë³¼ ìˆ˜ ìˆë„ë¡ í•„í„°ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
    filters = {"owner": ctx.user.identity}
    metadata = value.setdefault("metadata", {})
    metadata.update(filters)

    # ì‚¬ìš©ìê°€ ìì‹ ì˜ ë¦¬ì†ŒìŠ¤ë§Œ ë³¼ ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.
    return filters
```

í•¸ë“¤ëŸ¬ëŠ” ë‘ ê°œì˜ ë§¤ê°œë³€ìˆ˜ë¥¼ ë°›ìŠµë‹ˆë‹¤:

1. `ctx` ([AuthContext](../../cloud/reference/sdk/python_sdk_ref.md#langgraph_sdk.auth.types.AuthContext)): í˜„ì¬ `user`, ì‚¬ìš©ìì˜ `permissions`, `resource` ("threads", "crons", "assistants") ë° ìˆ˜í–‰ ì¤‘ì¸ `action` ("create", "read", "update", "delete", "search", "create_run")ì— ëŒ€í•œ ì •ë³´ë¥¼ í¬í•¨í•©ë‹ˆë‹¤.
2. `value` (`dict`): ìƒì„±ë˜ê±°ë‚˜ ì ‘ê·¼ë˜ê³  ìˆëŠ” ë°ì´í„°. ì´ dictì˜ ë‚´ìš©ì€ ì ‘ê·¼ ì¤‘ì¸ ë¦¬ì†ŒìŠ¤ì™€ ì‘ì—…ì— ë”°ë¼ ë‹¤ë¦…ë‹ˆë‹¤. ë” ì„¸ë°€í•œ ë²”ìœ„ì˜ ì ‘ê·¼ ì œì–´ì— ëŒ€í•œ ì •ë³´ëŠ” [ìŠ¤ì½”í”„ê°€ ìˆëŠ” ì¸ì¦ í•¸ë“¤ëŸ¬ ì¶”ê°€](#scoped-authorization)ì—ì„œ í™•ì¸í•˜ì„¸ìš”.

ìš°ë¦¬ì˜ ê°„ë‹¨í•œ í•¸ë“¤ëŸ¬ëŠ” ë‘ ê°€ì§€ ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤:

1. ì‚¬ìš©ìì˜ IDë¥¼ ë¦¬ì†ŒìŠ¤ì˜ ë©”íƒ€ë°ì´í„°ì— ì¶”ê°€í•©ë‹ˆë‹¤.
2. ì‚¬ìš©ìê°€ ìì‹ ì´ ì†Œìœ í•œ ë¦¬ì†ŒìŠ¤ë§Œ ë³¼ ìˆ˜ ìˆë„ë¡ ë©”íƒ€ë°ì´í„° í•„í„°ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.

## ê°œì¸ ëŒ€í™” í…ŒìŠ¤íŠ¸í•˜ê¸°

ìš°ë¦¬ì˜ ì¸ì¦ì„ í…ŒìŠ¤íŠ¸í•´ë´…ì‹œë‹¤. ëª¨ë“  âœ… ë©”ì‹œì§€ë¥¼ ë³¼ ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤. ê°œë°œ ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš” ( `langgraph dev` ëª…ë ¹ì„ ì‹¤í–‰í•˜ì„¸ìš”):

```python
from langgraph_sdk import get_client

# ë‘ ì‚¬ìš©ìë¥¼ ìœ„í•œ í´ë¼ì´ì–¸íŠ¸ ìƒì„±
alice = get_client(
    url="http://localhost:2024",
    headers={"Authorization": "Bearer user1-token"}
)

bob = get_client(
    url="http://localhost:2024",
    headers={"Authorization": "Bearer user2-token"}
)

# ì•¨ë¦¬ìŠ¤ê°€ ë¹„ì„œ ìƒì„±
alice_assistant = await alice.assistants.create()
print(f"âœ… ì•¨ë¦¬ìŠ¤ê°€ ë¹„ì„œ ìƒì„±: {alice_assistant['assistant_id']}")

# ì•¨ë¦¬ìŠ¤ê°€ ìŠ¤ë ˆë“œ ìƒì„± ë° ì±„íŒ…
alice_thread = await alice.threads.create()
print(f"âœ… ì•¨ë¦¬ìŠ¤ê°€ ìŠ¤ë ˆë“œ ìƒì„±: {alice_thread['thread_id']}")

await alice.runs.create(
    thread_id=alice_thread["thread_id"],
    assistant_id="agent",
    input={"messages": [{"role": "user", "content": "ì•ˆë…•í•˜ì„¸ìš”, ì´ê²ƒì€ ì•¨ë¦¬ìŠ¤ì˜ ê°œì¸ ì±„íŒ…ì…ë‹ˆë‹¤"}]}
)

# ë°¥ì´ ì•¨ë¦¬ìŠ¤ì˜ ìŠ¤ë ˆë“œì— ì ‘ê·¼ ì‹œë„
try:
    await bob.threads.get(alice_thread["thread_id"])
    print("âŒ ë°¥ì€ ì•¨ë¦¬ìŠ¤ì˜ ìŠ¤ë ˆë“œë¥¼ ë´ì„œëŠ” ì•ˆë©ë‹ˆë‹¤!")
except Exception as e:
    print("âœ… ë°¥ì˜ ì ‘ê·¼ì´ ì˜¬ë°”ë¥´ê²Œ ê±°ë¶€ë¨:", e)

# ë°¥ì´ ìì‹ ì˜ ìŠ¤ë ˆë“œ ìƒì„±
bob_thread = await bob.threads.create()
await bob.runs.create(
    thread_id=bob_thread["thread_id"],
    assistant_id="agent",
    input={"messages": [{"role": "user", "content": "ì•ˆë…•í•˜ì„¸ìš”, ì´ê²ƒì€ ë°¥ì˜ ê°œì¸ ì±„íŒ…ì…ë‹ˆë‹¤"}]}
)
print(f"âœ… ë°¥ì´ ìì‹ ì˜ ìŠ¤ë ˆë“œ ìƒì„±: {bob_thread['thread_id']}")

# ìŠ¤ë ˆë“œ ëª©ë¡ - ê° ì‚¬ìš©ìëŠ” ìì‹ ì˜ ìŠ¤ë ˆë“œë§Œ ë³¸ë‹¤
alice_threads = await alice.threads.search()
bob_threads = await bob.threads.search()
print(f"âœ… ì•¨ë¦¬ìŠ¤ëŠ” {len(alice_threads)} ìŠ¤ë ˆë“œë¥¼ ë´…ë‹ˆë‹¤")
print(f"âœ… ë°¥ì€ {len(bob_threads)} ìŠ¤ë ˆë“œë¥¼ ë´…ë‹ˆë‹¤")
```

í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì¶œë ¥ì´ í‘œì‹œë©ë‹ˆë‹¤:

```bash
âœ… ì•¨ë¦¬ìŠ¤ê°€ ë¹„ì„œ ìƒì„±: fc50fb08-78da-45a9-93cc-1d3928a3fc37
âœ… ì•¨ë¦¬ìŠ¤ê°€ ìŠ¤ë ˆë“œ ìƒì„±: 533179b7-05bc-4d48-b47a-a83cbdb5781d
âœ… ë°¥ì˜ ì ‘ê·¼ì´ ì˜¬ë°”ë¥´ê²Œ ê±°ë¶€ë¨: í´ë¼ì´ì–¸íŠ¸ ì˜¤ë¥˜ '404 ì°¾ì„ ìˆ˜ ì—†ìŒ' URL 'http://localhost:2024/threads/533179b7-05bc-4d48-b47a-a83cbdb5781d'
ìì„¸í•œ ì •ë³´ëŠ” ë‹¤ìŒì„ ì°¸ì¡°í•˜ì„¸ìš”: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
âœ… ë°¥ì´ ìì‹ ì˜ ìŠ¤ë ˆë“œ ìƒì„±: 437c36ed-dd45-4a1e-b484-28ba6eca8819
âœ… ì•¨ë¦¬ìŠ¤ëŠ” 1 ìŠ¤ë ˆë“œë¥¼ ë´…ë‹ˆë‹¤
âœ… ë°¥ì€ 1 ìŠ¤ë ˆë“œë¥¼ ë´…ë‹ˆë‹¤
```

ì´ëŠ” ë‹¤ìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤:

1. ê° ì‚¬ìš©ìëŠ” ìì‹ ì˜ ìŠ¤ë ˆë“œë¥¼ ìƒì„±í•˜ê³  ì±„íŒ…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
2. ì‚¬ìš©ìëŠ” ì„œë¡œì˜ ìŠ¤ë ˆë“œë¥¼ ë³¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
3. ìŠ¤ë ˆë“œ ëª©ë¡ì€ ìì‹ ì˜ ê²ƒë§Œ í‘œì‹œë©ë‹ˆë‹¤.

## ë²”ìœ„ê°€ ì§€ì •ëœ ê¶Œí•œ ì²˜ë¦¬ ì¶”ê°€ {#scoped-authorization}

ê´‘ë²”ìœ„í•œ `@auth.on` í•¸ë“¤ëŸ¬ëŠ” ëª¨ë“  [ì¸ì¦ ì´ë²¤íŠ¸](../../concepts/auth.md#authorization-events)ì— í•´ë‹¹í•©ë‹ˆë‹¤. ì´ëŠ” ê°„ê²°í•˜ì§€ë§Œ `value` ë”•ì…”ë„ˆë¦¬ì˜ ë‚´ìš©ì´ ì˜ ë²”ìœ„ê°€ ì§€ì •ë˜ì§€ ì•Šìœ¼ë©°, ëª¨ë“  ë¦¬ì†ŒìŠ¤ì— ëŒ€í•´ ë™ì¼í•œ ì‚¬ìš©ì ìˆ˜ì¤€ì˜ ì ‘ê·¼ ì œì–´ê°€ ì ìš©ë¨ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ë³´ë‹¤ ì„¸ë¶„í™”ëœ ì ‘ê·¼ ì œì–´ë¥¼ ì›í•œë‹¤ë©´ íŠ¹ì • ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ íŠ¹ì • ì‘ì—…ì„ ì œì–´í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

íŠ¹ì • ë¦¬ì†ŒìŠ¤ ìœ í˜•ì— ëŒ€í•œ í•¸ë“¤ëŸ¬ë¥¼ ì¶”ê°€í•˜ê¸° ìœ„í•´ `src/security/auth.py`ë¥¼ ì—…ë°ì´íŠ¸í•˜ì„¸ìš”:

```python
# ì´ì „ í•¸ë“¤ëŸ¬ ìœ ì§€...

from langgraph_sdk import Auth

@auth.on.threads.create
async def on_thread_create(
    ctx: Auth.types.AuthContext,
    value: Auth.types.on.threads.create.value,
):
    """ìŠ¤ë ˆë“œë¥¼ ìƒì„±í•  ë•Œ ì†Œìœ ìë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
    
    ì´ í•¸ë“¤ëŸ¬ëŠ” ìƒˆë¡œìš´ ìŠ¤ë ˆë“œë¥¼ ìƒì„±í•  ë•Œ ì‹¤í–‰ë˜ë©° ë‘ ê°€ì§€ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤:
    1. ì†Œìœ ê¶Œì„ ì¶”ì í•˜ê¸° ìœ„í•´ ìƒì„± ì¤‘ì¸ ìŠ¤ë ˆë“œì— ë©”íƒ€ë°ì´í„°ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
    2. ìƒì„±ìë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ë³´ì¥í•˜ëŠ” í•„í„°ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
    """
    # ì˜ˆì œ ê°’:
    #  {'thread_id': UUID('99b045bc-b90b-41a8-b882-dabc541cf740'), 'metadata': {}, 'if_exists': 'raise'}

    # ìƒì„± ì¤‘ì¸ ìŠ¤ë ˆë“œì— ì†Œìœ ì ë©”íƒ€ë°ì´í„° ì¶”ê°€
    # ì´ ë©”íƒ€ë°ì´í„°ëŠ” ìŠ¤ë ˆë“œì™€ í•¨ê»˜ ì €ì¥ë˜ê³  ì§€ì†ë©ë‹ˆë‹¤.
    metadata = value.setdefault("metadata", {})
    metadata["owner"] = ctx.user.identity
    
    
    # ìƒì„±ìë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ì œí•œí•˜ëŠ” í•„í„° ë°˜í™˜
    return {"owner": ctx.user.identity}

@auth.on.threads.read
async def on_thread_read(
    ctx: Auth.types.AuthContext,
    value: Auth.types.on.threads.read.value,
):
    """ì‚¬ìš©ìê°€ ìì‹ ì˜ ìŠ¤ë ˆë“œë§Œ ì½ì„ ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.
    
    ì´ í•¸ë“¤ëŸ¬ëŠ” ì½ê¸° ì‘ì—…ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤. ìŠ¤ë ˆë“œëŠ” ì´ë¯¸ ì¡´ì¬í•˜ë¯€ë¡œ
    ë©”íƒ€ë°ì´í„°ë¥¼ ì„¤ì •í•  í•„ìš”ëŠ” ì—†ìœ¼ë©°, ì‚¬ìš©ìê°€ ìì‹ ì˜ ìŠ¤ë ˆë“œë§Œ ë³¼ ìˆ˜ ìˆë„ë¡
    í•„í„°ë¥¼ ë°˜í™˜í•˜ë©´ ë©ë‹ˆë‹¤.
    """
    return {"owner": ctx.user.identity}

@auth.on.assistants
async def on_assistants(
    ctx: Auth.types.AuthContext,
    value: Auth.types.on.assistants.value,
):
    # ì„¤ëª…ì„ ìœ„í•´ ëª¨ë“  ìš”ì²­ì„ ê±°ë¶€í•©ë‹ˆë‹¤.
    # ì–´ì‹œìŠ¤í„´íŠ¸ ë¦¬ì†ŒìŠ¤ì— ê´€ë ¨ëœ ìš”ì²­
    # ì˜ˆì œ ê°’:
    # {
    #     'assistant_id': UUID('63ba56c3-b074-4212-96e2-cc333bbc4eb4'),
    #     'graph_id': 'agent',
    #     'config': {},
    #     'metadata': {},
    #     'name': 'Untitled'
    # }
    raise Auth.exceptions.HTTPException(
        status_code=403,
        detail="ì‚¬ìš©ìì—ê²Œ í•„ìš”í•œ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.",
    )

# ì‚¬ìš©ì ì •ë³´ë¥¼ (user_id, resource_type, resource_id)ì™€ ê°™ì€ í˜•ì‹ìœ¼ë¡œ ì €ì¥í•œë‹¤ê³  ê°€ì •
@auth.on.store()
async def authorize_store(ctx: Auth.types.AuthContext, value: dict):
    # ê° ìŠ¤í† ì–´ í•­ëª©ì˜ "namespace" í•„ë“œëŠ” í•­ëª©ì˜ ë””ë ‰í† ë¦¬ì²˜ëŸ¼ ìƒê°í•  ìˆ˜ ìˆëŠ” íŠœí”Œì…ë‹ˆë‹¤.
    namespace: tuple = value["namespace"]
    assert namespace[0] == ctx.user.identity, "ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤."

```

ìœ„ ì½”ë“œì—ì„œ í•˜ë‚˜ì˜ ì „ì—­ í•¸ë“¤ëŸ¬ ëŒ€ì‹ , ì´ì œ ê°ê°ì˜ ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ íŠ¹ì • í•¸ë“¤ëŸ¬ê°€ ìˆìŠµë‹ˆë‹¤:

1. ìŠ¤ë ˆë“œ ìƒì„±
2. ìŠ¤ë ˆë“œ ì½ê¸°
3. ì–´ì‹œìŠ¤í„´íŠ¸ ì ‘ê·¼

ìœ„ ì„¸ ê°€ì§€ëŠ” ê°ê°ì˜ ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ íŠ¹ì • **ë™ì‘**ì— í•´ë‹¹í•˜ë©° (ìì„¸í•œ ë‚´ìš©ì€ [ë¦¬ì†ŒìŠ¤ ë™ì‘](../../concepts/auth.md#resource-actions) ì°¸ì¡°), ë§ˆì§€ë§‰ í•˜ë‚˜(`@auth.on.assistants`)ëŠ” `assistants` ë¦¬ì†ŒìŠ¤ì˜ _ëª¨ë“ _ ë™ì‘ì— í•´ë‹¹í•©ë‹ˆë‹¤. ê° ìš”ì²­ì— ëŒ€í•´ LangGraphëŠ” ì ‘ê·¼í•˜ë ¤ëŠ” ë¦¬ì†ŒìŠ¤ ë° ë™ì‘ì— ê°€ì¥ êµ¬ì²´ì ì¸ í•¸ë“¤ëŸ¬ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤. ì´ëŠ” ë„¤ ê°œì˜ í•¸ë“¤ëŸ¬ê°€ ì‹¤í–‰ë˜ë©°, ê´‘ë²”ìœ„í•˜ê²Œ ë²”ìœ„ê°€ ì§€ì •ëœ "`@auth.on`" í•¸ë“¤ëŸ¬ëŠ” ì‹¤í–‰ë˜ì§€ ì•ŠìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

í…ŒìŠ¤íŠ¸ íŒŒì¼ì— ë‹¤ìŒ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì¶”ê°€í•˜ì„¸ìš”:

```python
# ... ì´ì „ê³¼ ë™ì¼
# ì–´ì‹œìŠ¤í„´íŠ¸ ìƒì„± ì‹œë„. ì´ ì‘ì—…ì´ ì‹¤íŒ¨í•´ì•¼ í•©ë‹ˆë‹¤.
try:
    await alice.assistants.create("agent")
    print("âŒ ì•¨ë¦¬ìŠ¤ëŠ” ì–´ì‹œìŠ¤í„´íŠ¸ë¥¼ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!")
except Exception as e:
    print("âœ… ì•¨ë¦¬ìŠ¤ê°€ ì ‘ê·¼ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤:", e)

# ì–´ì‹œìŠ¤í„´íŠ¸ ê²€ìƒ‰ ì‹œë„. ì´ê²ƒë„ ì‹¤íŒ¨í•´ì•¼ í•©ë‹ˆë‹¤.
try:
    await alice.assistants.search()
    print("âŒ ì•¨ë¦¬ìŠ¤ëŠ” ì–´ì‹œìŠ¤í„´íŠ¸ë¥¼ ê²€ìƒ‰í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!")
except Exception as e:
    print("âœ… ì•¨ë¦¬ìŠ¤ê°€ ì–´ì‹œìŠ¤í„´íŠ¸ ê²€ìƒ‰ì— ëŒ€í•œ ì ‘ê·¼ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤:", e)

# ì•¨ë¦¬ìŠ¤ëŠ” ì—¬ì „íˆ ìŠ¤ë ˆë“œë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
alice_thread = await alice.threads.create()
print(f"âœ… ì•¨ë¦¬ìŠ¤ê°€ ìŠ¤ë ˆë“œë¥¼ ìƒì„±í–ˆìŠµë‹ˆë‹¤: {alice_thread['thread_id']}")
```

ê·¸ë¦¬ê³  í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ë‹¤ì‹œ ì‹¤í–‰í•©ë‹ˆë‹¤:

```bash
âœ… ì•¨ë¦¬ìŠ¤ê°€ ìŠ¤ë ˆë“œë¥¼ ìƒì„±í–ˆìŠµë‹ˆë‹¤: dcea5cd8-eb70-4a01-a4b6-643b14e8f754
âœ… ë°¥ì´ ì ‘ê·¼ì„ ì˜¬ë°”ë¥´ê²Œ ê±°ë¶€í–ˆìŠµë‹ˆë‹¤: í´ë¼ì´ì–¸íŠ¸ ì˜¤ë¥˜ '404 Not Found' URL 'http://localhost:2024/threads/dcea5cd8-eb70-4a01-a4b6-643b14e8f754'ì— ëŒ€í•œ
ìì„¸í•œ ì •ë³´ëŠ” ë‹¤ìŒ ë§í¬ë¥¼ í™•ì¸í•˜ì‹­ì‹œì˜¤: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404
âœ… ë°¥ì´ ìì‹ ì˜ ìŠ¤ë ˆë“œë¥¼ ìƒì„±í–ˆìŠµë‹ˆë‹¤: 400f8d41-e946-429f-8f93-4fe395bc3eed
âœ… ì•¨ë¦¬ìŠ¤ëŠ” 1ê°œì˜ ìŠ¤ë ˆë“œë¥¼ ë´…ë‹ˆë‹¤
âœ… ë°¥ì€ 1ê°œì˜ ìŠ¤ë ˆë“œë¥¼ ë´…ë‹ˆë‹¤
âœ… ì•¨ë¦¬ìŠ¤ê°€ ì ‘ê·¼ì„ ì˜¬ë°”ë¥´ê²Œ ê±°ë¶€í–ˆìŠµë‹ˆë‹¤:
ìì„¸í•œ ì •ë³´ëŠ” ë‹¤ìŒ ë§í¬ë¥¼ í™•ì¸í•˜ì‹­ì‹œì˜¤: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/500
âœ… ì•¨ë¦¬ìŠ¤ê°€ ê²€ìƒ‰ ë„ìš°ë¯¸ì— ëŒ€í•œ ì ‘ê·¼ì„ ì˜¬ë°”ë¥´ê²Œ ê±°ë¶€í–ˆìŠµë‹ˆë‹¤:
```

ì¶•í•˜í•©ë‹ˆë‹¤! ì—¬ëŸ¬ë¶„ì€ ê° ì‚¬ìš©ìê°€ ìì‹ ì˜ ê°œì¸ ëŒ€í™”ë¥¼ ê°€ì§€ëŠ” ì±—ë´‡ì„ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤. ì´ ì‹œìŠ¤í…œì€ ê°„ë‹¨í•œ í† í° ê¸°ë°˜ ì¸ì¦ì„ ì‚¬ìš©í•˜ê³  ìˆì§€ë§Œ, ìš°ë¦¬ê°€ ë°°ìš´ ì¸ì¦ íŒ¨í„´ì€ ì‹¤ì œ ì¸ì¦ ì‹œìŠ¤í…œ êµ¬í˜„ì—ë„ ì ìš©ë  ê²ƒì…ë‹ˆë‹¤. ë‹¤ìŒ íŠœí† ë¦¬ì–¼ì—ì„œëŠ” í…ŒìŠ¤íŠ¸ ì‚¬ìš©ìë¥¼ ì‹¤ì œ ì‚¬ìš©ì ê³„ì •ìœ¼ë¡œ ëŒ€ì²´í•˜ì—¬ OAuth2ë¥¼ ì‚¬ìš©í•  ê²ƒì…ë‹ˆë‹¤.

## ë‹¤ìŒ ë‹¨ê³„ëŠ” ë¬´ì—‡ì¸ê°€ìš”?

ì´ì œ ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ì ‘ê·¼ì„ ì œì–´í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ë‹¤ìŒìœ¼ë¡œ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

1. ì‹¤ì œ ì‚¬ìš©ì ê³„ì •ì„ ì¶”ê°€í•˜ê¸° ìœ„í•´ [í”„ë¡œë•ì…˜ ì¸ì¦](add_auth_server.md)ìœ¼ë¡œ ì´ë™í•˜ê¸°
2. [ì¸ì¦ íŒ¨í„´](../../concepts/auth.md#authorization)ì— ëŒ€í•´ ë” ì½ê¸°
3. ì´ íŠœí† ë¦¬ì–¼ì—ì„œ ì‚¬ìš©ëœ ì¸í„°í˜ì´ìŠ¤ ë° ë©”ì„œë“œì— ëŒ€í•œ ìì„¸í•œ ì •ë³´ëŠ” [API ë ˆí¼ëŸ°ìŠ¤](../../cloud/reference/sdk/python_sdk_ref.md#langgraph_sdk.auth.Auth) í™•ì¸í•˜ê¸°
